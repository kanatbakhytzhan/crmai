# üöÄ AI SALES MANAGER - SaaS Platform

## ‚úÖ –í–°–ï –ì–û–¢–û–í–û –ö –†–ê–ë–û–¢–ï!

–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å **–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è multi-tenant SaaS –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞**.

---

## üìä –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

### 1. Multi-Tenancy Architecture ‚úÖ
- –ö–∞–∂–¥–∞—è –∫–æ–º–ø–∞–Ω–∏—è –≤–∏–¥–∏—Ç –¢–û–õ–¨–ö–û —Å–≤–æ–∏ –∑–∞—è–≤–∫–∏
- –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- `owner_id` –≤–æ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö

### 2. JWT Authentication ‚úÖ
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∫–æ–º–ø–∞–Ω–∏–π)
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –¢–æ–∫–µ–Ω—ã —Å 7-–¥–Ω–µ–≤–Ω—ã–º —Å—Ä–æ–∫–æ–º –∂–∏–∑–Ω–∏

### 3. Async PostgreSQL ‚úÖ
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ë–î
- –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ Supabase (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ .env)
- –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLite (—Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ)

### 4. Pydantic v2 Schemas ‚úÖ
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- Type-safe API

### 5. –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã ‚úÖ
- POST `/api/chat` —Ç—Ä–µ–±—É–µ—Ç JWT —Ç–æ–∫–µ–Ω
- GET `/api/leads` —Ç—Ä–µ–±—É–µ—Ç JWT —Ç–æ–∫–µ–Ω
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ `owner_id` –∏–∑ —Ç–æ–∫–µ–Ω–∞

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–†–û–®–õ–û –£–°–ü–ï–®–ù–û:

```
‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è - OK
‚úÖ –õ–æ–≥–∏–Ω - OK  
‚úÖ Chat —Å JWT —Ç–æ–∫–µ–Ω–æ–º - OK (–±–æ—Ç –æ—Ç–≤–µ—Ç–∏–ª!)
‚úÖ GET /leads - OK
‚úÖ Multi-tenancy - OK (–∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç!)
```

---

## üéØ –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:

### –í–∞—Ä–∏–∞–Ω—Ç 1: Swagger UI (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:8000/docs

2. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:**
   - `POST /api/auth/register`
   - –ó–∞–ø–æ–ª–Ω–∏—Ç–µ: email, password, company_name
   - Execute

3. **–õ–æ–≥–∏–Ω:**
   - `POST /api/auth/login`
   - username: –≤–∞—à email
   - password: –≤–∞—à –ø–∞—Ä–æ–ª—å
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `access_token`

4. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:**
   - –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Authorize" –≤–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∞
   - –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω
   - "Authorize"

5. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:**
   - `POST /api/chat`
   - user_id: `telegram_123` (–ª—é–±–æ–π ID –∫–ª–∏–µ–Ω—Ç–∞)
   - text: `–•–æ—á—É –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–º`
   - Execute ‚Üí –ë–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç!

6. **–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫:**
   - `GET /api/leads`
   - Execute ‚Üí –£–≤–∏–¥–∏—Ç–µ —Å–≤–æ–∏ –∑–∞—è–≤–∫–∏

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç

```bash
python test_api.py
```

–í—ã —É–≤–∏–¥–∏—Ç–µ:
```
[OK] Polzovatel sozdan
[OK] Token poluchon
[OK] Otvet poluchon
[OK] Zayavki polucheny
[OK] IZOLATSIYA RABOTAET!
```

---

## üìÅ –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:

```
‚ú® –ù–û–í–´–ï –§–ê–ô–õ–´:
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ core/security.py           # JWT + Password Hashing
‚îÇ   ‚îú‚îÄ‚îÄ database/session.py        # Async PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ schemas/                   # Pydantic v2
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lead.py
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deps.py                # JWT dependencies
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ endpoints/auth.py      # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è + –õ–æ–≥–∏–Ω
‚îú‚îÄ‚îÄ migrations/init_postgres.sql   # SQL –¥–ª—è Supabase
‚îú‚îÄ‚îÄ docker-compose.yml             # PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îú‚îÄ‚îÄ test_api.py                    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ create_test_user.py            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —é–∑–µ—Ä–∞
‚îú‚îÄ‚îÄ MIGRATION_GUIDE.md             # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
‚îú‚îÄ‚îÄ ARCHITECTURE.md                # –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
‚îú‚îÄ‚îÄ README_SAAS.md                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ QUICKSTART_SAAS.md             # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

üîÑ –û–ë–ù–û–í–õ–ï–ù–ù–´–ï:
‚îú‚îÄ‚îÄ app/database/models.py         # + User, owner_id
‚îú‚îÄ‚îÄ app/database/crud.py           # Async –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ app/api/endpoints/chat.py      # + JWT auth
‚îú‚îÄ‚îÄ main.py                        # + Auth router
‚îú‚îÄ‚îÄ requirements.txt               # + JWT, asyncpg
‚îî‚îÄ‚îÄ .env                           # + Supabase, SECRET_KEY
```

---

## üîê –ù–ê–°–¢–†–û–ô–ö–ò –í .env:

```env
# Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–ì–û–¢–û–í–û - —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ):
# DATABASE_URL=postgresql+asyncpg://postgres:Kanaezz1515!@db.smxxvjudrskzpvnlfrfd.supabase.co:5432/postgres

# –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLite (—Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ):
DATABASE_URL=sqlite+aiosqlite:///./sales_bot.db

# JWT Security:
SECRET_KEY=a3f8b2e5d9c7a1f4e6b8d3c5a9f7e2b4d6c8a1f3e5b7d9c2a4f6e8b1d3c5a7f9

# Dev Mode: FALSE (–ë–î –ù–ï –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ)
DEV_MODE=FALSE
```

---

## üåê –ü–ï–†–ï–•–û–î –ù–ê SUPABASE:

–ö–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
2. SQL Editor ‚Üí –í—ã–ø–æ–ª–Ω–∏—Ç–µ `migrations/init_postgres.sql`
3. –í `.env` –∑–∞–º–µ–Ω–∏—Ç–µ DATABASE_URL –Ω–∞ Supabase
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
5. –ì–æ—Ç–æ–≤–æ!

---

## üì± –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ –Ω–∞ Supabase PostgreSQL
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–º–µ–Ω –∏ HTTPS
3. –î–æ–±–∞–≤—å—Ç–µ rate limiting
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Sentry)
5. CI/CD pipeline

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- Email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
- Refresh tokens
- –†–æ–ª–∏ (admin, manager, viewer)
- Dashboard –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- Webhook –¥–ª—è Telegram –∫–Ω–æ–ø–æ–∫
- Billing (Stripe)

---

## üéì –ê–†–•–ò–¢–ï–ö–¢–£–†–ê:

```
User (–ö–æ–º–ø–∞–Ω–∏—è)
  ‚Üì owner_id
  ‚îú‚îÄ‚îÄ BotUser (–ö–ª–∏–µ–Ω—Ç—ã –±–æ—Ç–∞)
  ‚îÇ     ‚Üì bot_user_id
  ‚îÇ     ‚îî‚îÄ‚îÄ Message (–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤)
  ‚îÇ
  ‚îî‚îÄ‚îÄ Lead (–ó–∞—è–≤–∫–∏)
        ‚Üì owner_id + bot_user_id
```

**Multi-tenancy:**
- User A ‚Üí –≤–∏–¥–∏—Ç –¢–û–õ–¨–ö–û —Å–≤–æ–∏ leads (owner_id=A)
- User B ‚Üí –≤–∏–¥–∏—Ç –¢–û–õ–¨–ö–û —Å–≤–æ–∏ leads (owner_id=B)

---

## ‚úÖ –ì–û–¢–û–í–û!

**–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω:** http://localhost:8000

**API Docs:** http://localhost:8000/docs

**–¢–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏:** –í–°–ï ‚úÖ

**–ú–æ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å!** üöÄ

---

## üìû –í–æ–ø—Ä–æ—Å—ã?

- `MIGRATION_GUIDE.md` - –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- `ARCHITECTURE.md` - –û–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- `QUICKSTART_SAAS.md` - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- `README_SAAS.md` - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
